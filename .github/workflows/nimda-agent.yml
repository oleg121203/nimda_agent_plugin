name: NIMDA Agent Auto-Development

on:
  schedule:
    # –ó–∞–ø—É—Å–∫ –∫–æ–∂–Ω—ñ 6 –≥–æ–¥–∏–Ω
    - cron: '0 */6 * * *'
  workflow_dispatch:
    inputs:
      command:
        description: 'NIMDA Agent Command'
        required: true
        default: '—Å—Ç–∞—Ç—É—Å'
        type: choice
        options:
          - '—Å—Ç–∞—Ç—É—Å'
          - '–¥–æ–ø—Ä–∞—Ü—é–π –¥–µ–≤–ø–ª–∞–Ω'
          - '–≤–∏–∫–æ–Ω–∞–π –≤–µ—Å—å –î–ï–í'
          - '—Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è'

jobs:
  nimda-agent:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        fetch-depth: 0

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install NIMDA Agent dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests pyyaml pathlib

    - name: Run NIMDA Agent
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        NIMDA_COMMAND: ${{ github.event.inputs.command || '—Å—Ç–∞—Ç—É—Å' }}
      run: |
        echo "ü§ñ –ó–∞–ø—É—Å–∫ NIMDA Agent –∑ –∫–æ–º–∞–Ω–¥–æ—é: $NIMDA_COMMAND"
        # –¢—É—Ç –±—É–¥–µ –∫–æ–¥ –¥–ª—è –∑–∞–ø—É—Å–∫—É NIMDA Agent
        python -c "
import os
print(f'ü§ñ NIMDA Agent Command: {os.getenv("NIMDA_COMMAND", "—Å—Ç–∞—Ç—É—Å")}')
print('üìÅ Project structure:')
for root, dirs, files in os.walk('.'):
    level = root.replace('.', '').count(os.sep)
    indent = ' ' * 2 * level
    print(f'{indent}{os.path.basename(root)}/')
    subindent = ' ' * 2 * (level + 1)
    for file in files[:5]:  # –ü–æ–∫–∞–∑–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ –ø–µ—Ä—à—ñ 5 —Ñ–∞–π–ª—ñ–≤
        print(f'{subindent}{file}')
    if len(files) > 5:
        print(f'{subindent}... —Ç–∞ {len(files)-5} —ñ–Ω—à–∏—Ö —Ñ–∞–π–ª—ñ–≤')
"

    - name: Commit and push changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "NIMDA Agent"
        git add .
        if ! git diff --cached --exit-code; then
          git commit -m "ü§ñ NIMDA Agent: –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ –∑–º—ñ–Ω–∏"
          git push
        else
          echo "–ù–µ–º–∞—î –∑–º—ñ–Ω –¥–ª—è –∫–æ–º—ñ—Ç—É"
        fi
